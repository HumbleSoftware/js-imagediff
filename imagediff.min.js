// js-imagediff 1.0.3
// (c) 2011-2012 Carl Sutherland, Humble Software
// Distributed under the MIT License
// For original source and documentation visit:
// http://www.github.com/HumbleSoftware/js-imagediff

(function(e,t){var n=this;if(typeof module!="undefined"){var r=require("canvas");module.exports=t(n,e,r)}else typeof define=="function"&&typeof define.amd=="object"?define(t):n[e]=t(n,e)})("imagediff",function(e,t,n){function d(e,t){var r=n?new n:document.createElement("canvas");return e&&(r.width=e),t&&(r.height=t),r}function v(e,t){return f.width=e,f.height=t,l.clearRect(0,0,e,t),l.createImageData(e,t)}function m(e){var t=/^([A-Za-z0-9+\/]{4})*([A-Za-z0-9+\/]{4}|[A-Za-z0-9+\/]{3}=|[A-Za-z0-9+\/]{2}==)$/,n=/^data:image\/(png|jpg);base64,/,r=e.match(n);return r==null?!1:t.test(e.replace(n,""))}function g(e){return S(e,o)}function y(e){return S(e,i)}function b(e){return S(e,s)}function w(e){return!!e&&!!S(e,u)&&typeof e.width!==a&&typeof e.height!==a&&typeof e.data!==a}function E(e){return m(e)||g(e)||y(e)||b(e)||w(e)}function S(e,t){return typeof e=="object"&&!!Object.prototype.toString.apply(e).match(t)}function x(e){var t=e.height,n=e.width,r=e.data,i,s,o;f.width=n,f.height=t,i=l.getImageData(0,0,n,t),s=i.data;for(o=e.data.length;o--;)s[o]=r[o];return i}function T(e){if(m(e))return N(e);if(g(e))return C(e);if(y(e))return k(e);if(b(e))return L(e);if(w(e))return e}function N(e){var t=new n.Image;t.src=e;var r=t.height,i=t.width;return f.width=i,f.height=r,l.clearRect(0,0,i,r),l.drawImage(t,0,0),l.getImageData(0,0,i,r)}function C(e){var t=e.height,n=e.width;return f.width=n,f.height=t,l.clearRect(0,0,n,t),l.drawImage(e,0,0),l.getImageData(0,0,n,t)}function k(e){var t=e.height,n=e.width,r=e.getContext("2d");return r.getImageData(0,0,n,t)}function L(e){var t=e.canvas,n=t.height,r=t.width;return e.getImageData(0,0,r,n)}function A(e){var t=T(e),n=d(t.width,t.height),r=n.getContext("2d");return r.putImageData(t,0,0),n}function O(e,t){return e.width===t.width}function M(e,t){return e.height===t.height}function _(e,t){return M(e,t)&&O(e,t)}function D(e,t,n){var r=e.data,i=t.data,s=r.length,o;n=n||0;if(!_(e,t))return!1;for(o=s;o--;)if(r[o]!==i[o]&&Math.abs(r[o]-i[o])>n)return!1;return!0}function P(e,t){return(_(e,t)?H:B)(e,t)}function H(e,t){var n=e.height,r=e.width,i=v(r,n),s=e.data,o=t.data,u=i.data,a=u.length,f,l,c,h,p,d;for(c=0;c<a;c+=4)u[c]=Math.abs(s[c]-o[c]),u[c+1]=Math.abs(s[c+1]-o[c+1]),u[c+2]=Math.abs(s[c+2]-o[c+2]),u[c+3]=Math.abs(255-s[c+3]-o[c+3]);return i}function B(e,t){function g(e){a=Math.floor((n-e.height)/2),f=Math.floor((r-e.width)/2)}var n=Math.max(e.height,t.height),r=Math.max(e.width,t.width),i=v(r,n),s=e.data,o=t.data,u=i.data,a,f,l,c,h,p,d,m;for(h=u.length-1;h>0;h-=4)u[h]=255;g(e);for(l=e.height;l--;)for(c=e.width;c--;)h=4*((l+a)*r+(c+f)),p=4*(l*e.width+c),u[h+0]=s[p+0],u[h+1]=s[p+1],u[h+2]=s[p+2];g(t);for(l=t.height;l--;)for(c=t.width;c--;)h=4*((l+a)*r+(c+f)),p=4*(l*t.width+c),u[h+0]=Math.abs(u[h+0]-o[p+0]),u[h+1]=Math.abs(u[h+1]-o[p+1]),u[h+2]=Math.abs(u[h+2]-o[p+2]);return i}function j(){var e;for(e=0;e<arguments.length;e++)if(!E(arguments[e]))throw{name:"ImageTypeError",message:"Submitted object was not an image."}}function F(e,t){return e=document.createElement(e),e&&t&&(e.innerHTML=t),e}function I(e,t,n){var r=A(e),i,s;n=n||Function,i=r.toDataURL().replace(/^data:image\/\w+;base64,/,""),s=new Buffer(i,"base64"),require("fs").writeFile(t,s,n)}var r=/\[object Array\]/i,i=/\[object (Canvas|HTMLCanvasElement)\]/i,s=/\[object CanvasRenderingContext2D\]/i,o=/\[object (Image|HTMLImageElement)\]/i,u=/\[object ImageData\]/i,a="undefined",f=d(),l=f.getContext("2d"),c=e[t],h,p;return p={toBeImageData:function(){return h.isImageData(this.actual)},toImageDiffEqual:function(e,t){return typeof document!==a&&(this.message=function(){var t=F("div"),n=F("div","<div>Actual:</div>"),r=F("div","<div>Expected:</div>"),i=F("div","<div>Diff:</div>"),s=h.diff(this.actual,e),o=d(),u;return o.height=s.height,o.width=s.width,t.style.overflow="hidden",n.style.float="left",r.style.float="left",i.style.float="left",u=o.getContext("2d"),u.putImageData(s,0,0),n.appendChild(A(this.actual)),r.appendChild(A(e)),i.appendChild(o),t.appendChild(n),t.appendChild(r),t.appendChild(i),[t,"Expected not to be equal."]}),h.equal(this.actual,e,t)}},h={createCanvas:d,createImageData:v,isBase64Image:m,isImage:g,isCanvas:y,isContext:b,isImageData:w,isImageType:E,toImageData:function(e){return j(e),w(e)?x(e):T(e)},equal:function(e,t,n){return j(e,t),e=T(e),t=T(t),D(e,t,n)},diff:function(e,t){return j(e,t),e=T(e),t=T(t),P(e,t)},jasmine:p,noConflict:function(){return e[t]=c,h}},typeof module!="undefined"&&(h.imageDataToPNG=I),h})